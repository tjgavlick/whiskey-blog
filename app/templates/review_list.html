{% extends "base.html" %}

{% block title %}Reviews // {% endblock %}

{% block body %}
    <section role="main">

        <header class="title-bar title-bar--search">
            <h1 class="title-bar__title">Reviews</h1>

            <div class="title-bar__related">
                <a href="ethics.htm" class="title-bar__related__item">Review ethics</a>
                <a href="ratings.htm" class="title-bar__related__item">Why listen to me?</a>
                <a href="glossary.htm" class="title-bar__related__item">Lingo</a>
            </div>
        </header>

        <div id="search-area">

            {% if request.args %}
                <div class="search-current-filters">
                    <p>
                        Showing
                        {% if request.args['rarity'] %}
                            <a href="{{ modify_query(rarity=None) }}" class="search-current-filters__close">{{ rarities[request.args['rarity']].filter_name }}</a>
                        {% endif %}
                        {% if not request.args['rarity'] and not (request.args['age'] or request.args['origin'] or request.args['proof'] or request.args['price']) %}
                            all
                        {% endif %}
                        {% if request.args['type'] %}
                            <a href="{{ modify_query(type=None) }}" class="search-current-filters__close">{{ drink_types[request.args['type']].filter_name }}</a>
                        {% else %}
                            whiskies
                        {% endif %}
                        {% if request.args['age'] %}
                            <a href="{{ modify_query(age=None) }}" class="search-current-filters__close">{{ age_ranges[request.args['age']].filter_name }}</a>{% if (request.args['origin'] and request.args['proof']) or (request.args['proof'] and request.args['price']) or (request.args['origin'] and request.args['price']) %},{% endif %}
                        {% endif %}
                        {% if request.args['origin'] %}
                            {% if request.args['age'] and not (request.args['proof'] or request.args['price']) %}
                                and
                            {% endif %}
                            distilled in
                            <a href="{{ modify_query(origin=None) }}" class="search-current-filters__close">{{ this_origin.name }}</a>{% if (request.args['age'] and request.args['proof']) or (request.args['age'] and request.args['price']) or (request.args['proof'] and request.args['price']) %},{% endif %}
                        {% endif %}
                        {% if request.args['proof'] %}
                            {% if (request.args['age'] or request.args['origin']) and not request.args['price'] %}
                                and
                            {% endif %}
                            bottled at
                            <a href="{{ modify_query(proof=None) }}" class="search-current-filters__close">{{ proof_ranges[request.args['proof']].filter_name }}</a>{% if (request.args['origin'] and request.args['price']) or (request.args['age'] and request.args['price']) %},{% endif %}
                        {% endif %}
                        {% if request.args['price'] %}
                            {% if request.args['age'] or request.args['origin'] or request.args['proof'] %}
                                and
                            {% endif %}
                            sold for
                            <a href="{{ modify_query(price=None) }}" class="search-current-filters__close">{{ price_ranges[request.args['price']].filter_name }}</a>
                        {% endif %}
                        <span class="search-current-filters__nudge">.</span>
                        {% if request.args['sort'] %}
                            They're sorted by
                            <a href="{{ modify_query(sort=None) }}" class="search-current-filters__close">{{ review_sorts[request.args['sort']].filter_name }}</a>.
                        {% endif %}
                        You can <a href="{{ request.path }}" class="search-current-filters__close">remove these filters</a> if you'd like</p>
                    </p>
                </div>
            {% else %}
                <p class="search-current-filters__none">
                    Showing all whiskies. You can filter this list below
                </p>
            {% endif %}

            <div class="search-layout">
                <button type="button" class="search-refine__toggle" data-toggle-target="next">Refine <img src="/static/images/arrow-right.png" alt="" class="search-refine__toggle__arrow" /></button>
                <div class="search-refine">
                    <div class="grid grid--compact">
                        <div class="search-refine__facet grid__unit">
                            <h3 class="search-refine__facet__title">Sort by</h3>
                            <ul class="search-refine__facet__list">
                                {% for key, vals in review_sorts.items()|sort(attribute='0') %}
                                    {% if request.args['sort'] == key %}
                                        <li class="search-refine__facet__item is-current">
                                            {{ vals['name'] }}
                                        </li>
                                    {% else %}
                                        <li class="search-refine__facet__item">
                                            <a href="{{ modify_query(sort=key) }}">{{ vals['name'] }}</a>
                                        </li>
                                    {% endif %}
                                {% endfor %}
                            </ul>
                        </div>
                        <div class="search-refine__facet grid__unit grid__unit--1-2-s grid__unit--1-3-m grid__unit--1-1-l">
                            <h3 class="search-refine__facet__title">Type</h3>
                            <ul class="search-refine__facet__list">
                                {% for key, vals in drink_types.items()|sort(attribute='0') %}
                                    {% if request.args['type'] == key %}
                                        <li class="search-refine__facet__item is-current">
                                            {{ vals['name'] }}
                                        </li>
                                    {% else %}
                                        <li class="search-refine__facet__item">
                                            <a href="{{ modify_query(type=key) }}">{{ vals['name'] }}</a>
                                        </li>
                                    {% endif %}
                                {% endfor %}
                            </ul>
                        </div>
                        <div class="search-refine__facet grid__unit grid__unit--1-2-s grid__unit--1-3-m grid__unit--1-1-l">
                            <h3 class="search-refine__facet__title">Rarity</h3>
                            <ul class="search-refine__facet__list">
                                {% for key, vals in rarities.items()|sort(attribute='1.value') %}
                                    {% if request.args['rarity'] == key %}
                                        <li class="search-refine__facet__item is-current">
                                            {{ vals['name'] }}
                                        </li>
                                    {% else %}
                                        <li class="search-refine__facet__item">
                                            <a href="{{ modify_query(rarity=key) }}">{{ vals['name'] }}</a>
                                        </li>
                                    {% endif %}
                                {% endfor %}
                            </ul>
                        </div>
                        <div class="search-refine__facet grid__unit grid__unit--1-2-s grid__unit--1-3-m grid__unit--1-1-l">
                            <h3 class="search-refine__facet__title">Age</h3>
                            {% for key, vals in age_ranges.items()|sort(attribute='1.age_min') %}
                                {% if request.args['age'] == key %}
                                    <li class="search-refine__facet__item is-current">
                                        {{ vals['name'] }}
                                    </li>
                                {% else %}
                                    <li class="search-refine__facet__item">
                                        <a href="{{ modify_query(age=key) }}">{{ vals['name'] }}</a>
                                    </li>
                                {% endif %}
                            {% endfor %}
                        </div>
                        <div class="search-refine__facet grid__unit grid__unit--1-2-s grid__unit--1-3-m grid__unit--1-1-l">
                            <h3 class="search-refine__facet__title">Distilled in</h3>
                            <ul class="search-refine__facet__list">
                                {% for origin in origins|sort(attribute='name') %}
                                    {% if request.args['origin'] == origin.id|string %}
                                        <li class="search-refine__facet__item is-current">
                                            {{ origin.name }}
                                        </li>
                                    {% else %}
                                        <li class="search-refine__facet__item">
                                            <a href="{{ modify_query(origin=origin.id) }}">{{ origin.name }}</a>
                                        </li>
                                    {% endif %}
                                {% endfor %}
                            </ul>
                        </div>
                        <div class="search-refine__facet grid__unit grid__unit--1-2-s grid__unit--1-3-m grid__unit--1-1-l">
                            <h3 class="search-refine__facet__title">Proof</h3>
                            <ul class="search-refine__facet__list">
                                {% for key, vals in proof_ranges.items()|sort(attribute='1.proof_min') %}
                                    {% if request.args['proof'] == key %}
                                        <li class="search-refine__facet__item is-current">
                                            {{ vals['name'] }}
                                        </li>
                                    {% else %}
                                        <li class="search-refine__facet__item">
                                            <a href="{{ modify_query(proof=key) }}">{{ vals['name'] }}</a>
                                        </li>
                                    {% endif %}
                                {% endfor %}
                            </ul>
                        </div>
                        <div class="search-refine__facet grid__unit grid__unit--1-2-s grid__unit--1-3-m grid__unit--1-1-l">
                            <h3 class="search-refine__facet__title">Price (MSRP)</h3>
                            <ul class="search-refine__facet__list">
                                {% for key, vals in price_ranges.items()|sort(attribute='1.price_min') %}
                                    {% if request.args['price'] == key %}
                                        <li class="search-refine__facet__item is-current">
                                            {{ vals['name'] }}
                                        </li>
                                    {% else %}
                                        <li class="search-refine__facet__item">
                                            <a href="{{ modify_query(price=key) }}">{{ vals['name'] }}</a>
                                        </li>
                                    {% endif %}
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>


                <div class="search-content content">

                    <div class="page-bound">
                        {% if reviews %}
                            <ul class="post-list">
                                {% for review in reviews %}
                                    {{ includes.post_list_item(review.title,
                                            subtitle=review.subtitle,
                                            description=review.abstract,
                                            image=review.image_list,
                                            url=url_for('view_review', review_name=review.url)) }}
                                {% endfor %}
                            </ul>
                        {% else %}
                            <p class="post-list-empty">No reviews matched these criteria. {{ no_reviews_message }}</p>
                        {% endif %}
                    </div>
                </div>
            </div><!-- .search-layout -->
        </div><!-- #search-area -->

    </section>
{% endblock %}
